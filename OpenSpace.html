<html>

<head>
    <meta charset="utf-8">
    
    <!-- Icons Import -->
    <script src="https://use.fontawesome.com/06e679ac1f.js"></script>
    
    <link rel="shortcut icon" href="Rakete.ico" type="x-icon">
    <link rel="icon" href="Rakete.ico" type="image/x-icon">

    <title>Open Space Simulator</title>
    
    <link rel="stylesheet" href="styles/mainStyle.css">
    <link rel="stylesheet" href="UserInterface/jquery-ui-1.12.1.custom/jquery-ui.min.css">
    <link rel="stylesheet" href="styles/GameInterfaceCSS.css">
    <link rel="stylesheet" href="styles/EntwicklerInterfaceCSS.css">
    <link rel="stylesheet" href="styles/cmGauge.css">
</head>

<body>

    <div id="container"></div>


    <!-- Imports -->
    <script src="script/jquery-3.1.1.min.js"></script>
    <script src="UserInterface/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <script src="three.js/build/three_64.js"></script>
    <script src="three.js/examples/Detector.js"></script>
    <script src="three.js/examples/js/libs/stats.min.js"></script>
    <script src="three.js/examples/js/libs/dat.gui.min.js"></script>
    <script src="three.js/examples/js/controls/OrbitControls.js"></script>
    <script src="loader/ColladaLoader.js"></script>
    <script src="script/userInterface.js"></script>
    <script src="script/universe.js"></script>
    <script src="script/data.js"></script>
    <script src="script/rocketData.js"></script>
    <script src="script/rocketPhysics.js"></script>
    <script src="script/universePhysics.js"></script>
    <script src="script/physics.js"></script>
    
     <!-- UI Imports -->
    <script src="UserInterface/variables.js"></script>
    <script src="UserInterface/UIObjectBuilder.js"></script>
    <script src="UserInterface/control.js"></script>
    <script src="UserInterface/js/cmGauge.js"></script>
    <script src="UserInterface/UIFunctions.js"></script>
    
    <!-- User Interface -->
    <div id="mainBox">

        <!-- Header -->
        <div id="headerBox">

            <div class="logoBox">
                <!--<img src="logo-mit-text.png" alt="Logo" class="logo" height=15% width=auto>-->
                <img src="logotext.png" alt="Logo" height=20px width=auto>
                <img src="nurlogo.png" alt="Logo" class="logo" height=5% width=auto>
            </div>

            <!--
                <div class="titleBox">
                    <h1>OpenSpaceSimulator</h1>
                </div>
    -->
        </div>

        <!-- Content Box -->
        <div id="contentBox">

            <div id="tabBox">
                <input type="button" id="rocket" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf0ad" title="Rocket Settings" onclick="doToggle(this)">
                <input type="button" id="developer" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf013" title="Universe Settings" onclick="doToggle(this)">
            </div>
            <!-- Rocket Interface-->
            
            <div id="rocketInterface" class="interfaceTab">
                <div class="rocketBox">
                    <fieldset>
                        <legend>Rocket</legend>
                        <select name="rocketSelect" id="rocketSelect">
                            <option value="saturnV">Saturn V</option>
                        </select>
                    </fieldset>
                </div>
                <div id="editBox">
                    <fieldset>
                        <legend>Editor</legend>
                        <div class="fuelBox">
                            <div class="fuelLabelBox">
                                <label class="ui-heading">Fuel</label>
                            </div>
                            <div class="oxygenLabelBox">
                                <label>Oxygen:</label><span id="oxygenLabel" class="valueSpan"></span>
                            </div>
                            <div class="oxygenRangeBox">
                                <div id="oxygen"></div>
                            </div>
                            <div class="keroseneLabelBox">
                                <label>Kerosene:</label><span id="keroseneLabel" class="valueSpan"></span>
                            </div>
                            <div class="keroseneRangeBox">
                                <div id="kerosene"></div>
                            </div>
                        </div>
                        <div class="stagesLabelBox">
                                <label class="ui-heading">Stages:</label><span id="stagesLabel" class="valueSpan"></span>
                            </div>
                        <div class="stagesRangeBox">
                                <div id="stages"></div>
                            </div>
                        <div class="massBox">
                            <div class="massLabelBox">
                                <label class="ui-heading">Mass</label>
                            </div>
                            <div class="emptyMassLabelBox">
                                <label>Empty Mass:</label><span id="emptyMassLabel" class="valueSpan"></span>
                            </div>
                            <div class="emptyMassRangeBox">
                                <div id="emptyMass"></div>
                            </div>
                            <div class="fuelMassLabelBox">
                                <label class="fuelMassLabel">Fuel Mass:</label><span id="fuelMassLabel" class="valueSpan"></span>
                            </div>
                            <div class="fuelMassRangeBox">
                                <div id="fuelMass"></div>
                            </div>
                            <div class="totalMassLabelBox">
                                <label>Total Mass: <span id=totalMass class="valueSpan"></span>
                                </label>
                            </div>
                        </div>
                        <div class="engineBox">
                            <div class="engineLabelBox">
                                <label class="engineLabel ui-heading">Engine</label>
                            </div>
                            <div class="engineSelectBox">
                                <select name="engineSelect" id="engineSelect">
                                    <option>Engine1</option>
                                    <option>Engine2</option>
                                    <option>Engine3</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <!-- Rocket Interface End -->


            <!-- Developer Interface-->
            <div id="developerInterface" class="interfaceTab">
                <div id="dialog"></div>
                <div class="menuBox">
                    <!--
                    <div class="quitButtonBox">
                        <input type="button" name="quit" value="Quit" />
                    </div>
    -->
                </div>
                <div class="gameBox">
                    <div class="controlBox">


                        <fieldset class="fieldSetPadding">
                            <legend>Planet</legend>
                            <div class="planetBox">
                                <div class="planetSelectLabelBox">
                                    <div class="planetLabelBox">
                                        <label class="planetLabel">Planet</label>
                                    </div>
                                    <div class="planetSelectBox">
                                        <select name="planetSelect" id="planetSelect">
                                            <option value="sun">Sun</option>
                                            <option value="mercury">Mercury</option>
                                            <option value="venus">Venus</option>
                                            <option value="earth" selected="true">Earth</option>
                                            <option value="earth_moon">Moon</option>
                                            <option value="mars">Mars</option>
                                            <option value="jupiter">Jupiter</option>
                                            <option value="saturn">Saturn</option>
                                            <option value="uranus">Uranus</option>
                                            <option value="neptune">Neptune</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="planetSizeBox">
                                    <div class="planetLabelBox">
                                        <label>Planet Size:</label><span id="planetSizeLabel" class="valueSpan">1</span>
                                    </div>
                                    <div id="planetSize"></div>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset class="fieldSetPadding">
                            <legend>Time</legend>
                            <div class="timeBox">
                                <div class="timeLabelBox">
                                    <label>Time Factor:</label><span id="timeFactorLabel" class="valueSpan">1</span>
                                </div>
                                <div id="timeFactor"></div>
                            </div>
                        </fieldset>
                        <!--                    <div class="resetBox"> 
                            <input type="reset" name="reset" value="Reset" />
                        </div>-->
                    </div>
                    <div class="simulationBox">
                        <div class="developerBox">
                            <div id="cameraBox">
                                <fieldset>
                                    <legend>Camera</legend>
                                    <!--<select onchange="switchCamera(this.value)">-->
                                    <select name="planetCamera" id="planetCamera">
                                        <option value="sun">Sun</option>
                                        <option value="mercury">Mercury</option>
                                        <option value="venus">Venus</option>
                                        <option value="earth" selected="true">Earth</option>
                                        <option value="earth_moon">Moon</option>
                                        <option value="mars">Mars</option>
                                        <option value="jupiter">Jupiter</option>
                                        <option value="saturn">Saturn</option>
                                        <option value="uranus">Uranus</option>
                                        <option value="neptune">Neptune</option>
                                        <option value="launchpad">Launchpad</option>
                                        <option value="rocket">Rocket</option>
                                    </select>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Developer Interface End -->



            <input type="button" id="game" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf135" title="Flightboard" onclick="doToggle(this)">
            <!-- Game Interface-->
            <div id="gameInterface">
                <div class="gameBox">
                    <div class="menuBox">
                        <input type="button" name="playPause" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf04b;" title="Continue Game">
                        <br>
                        <!--<input type="button" name="pause" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf04c;" title="Pause Game"> <br>-->
                        <input type="button" name="launch" class="btn fa ui-button ui-widget ui-corner-all" value="Launch" title="Launch">
                        <br>
                        <input type="button" name="timeFaster" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf017; &#xf04e;" title="">
                        <br>
                        <input type="button" name="timeSlower" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf017; &#xf04a;" title="">
                        <br>
                        <input type="button" name="quit" class="btn fa ui-button ui-widget ui-corner-all" value="Quit" />&nbsp;
                        <input type="button" name="reset" class="btn fa ui-button ui-widget ui-corner-all" value="Start New Game" />
                    </div>

                    <div class="dashboardBox">
                        <div class="steeringBox">
                            <div class="throttleBox">
                                <input type="button" name="throttle" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf0d8; &#xf06d;" title="More Throttle">
                                <br>
                                <input type="button" name="brake" class="btn fa ui-button ui-widget ui-corner-all fa-flip-vertical" value="&#xf0d8; &#xf06d;" title="Less Throttle">
                            </div>
                            <div class="controlBox">
                                  <input type="button" name="rollLeft" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf0e2;">
                                <input type="button" name="up" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf062;">
                                <input type="button" name="rollRight" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf01e;">
                                <br>
                                <input type="button" name="left" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf060;">
                                <input type="button" name="down" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf063;">
                                <input type="button" name="right" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf061;">
                            </div>
                            <div class="sasBox">
                                <input type="button" name="sas" class="btn fa ui-button ui-widget ui-corner-all" value="&#xf0cc;" title="SAS Stabilisation">
                            </div>
                        </div>
                        <div class="displayBox">
                            <!-- Speed -->
                            <div class="speedBox">
                                <div id="speed" class="gauge gauge-big gauge-orange">
                                    <div class="gauge-arrow" data-percentage="40" style="transform: rotate(0deg);"></div>
                                </div>
                                <br>
                                <label>
                                    <span id="speedLabel">
                                            0 
                                            </span>
                                    km/h
                                </label>
                            </div>
                            <!-- Fuel -->
                            <div class="fuelBox">
                                <div id="fuel" class="gauge gauge-small gauge-orange">
                                    <div class="gauge-arrow" data-percentage="40" style="transform: rotate(0deg);"></div>
                                </div>
                                <br>
                                <label>
                                    <span id="fuelLabel">
                                            0 
                                            </span>
                                    t
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Game Interface End -->
        </div>
        <!-- Content Box End -->

        <!-- Footer Box -->
        <!--
            <div id="footerBox">
                <div class="impressumBox">
                    <a href="impressum.jsp">Impressum</a>
                </div>
            </div>
    -->
    </div>
    <!-- User Inreface End -->



    <!-- Vertex  -->
    <script type="x-shader/x-vertex" id="vertexShader">
        uniform vec4 sunPosition;

        //test for bumpmap
        vec3 tangent_base = vec3 (0, 1, 0);
        varying vec3 view;
        varying vec3 tbase;
        
        
        varying vec2 vUv;
        varying vec3 vNormal;
        varying vec3 sunDirection;
        varying vec4 mvPosition;
        
#include <common>
#include <logdepthbuf_pars_vertex>

        void main() {
                vUv = uv;
                mvPosition = modelViewMatrix * vec4(position, 1.0);
                sunDirection = sunPosition.xyz - mvPosition.xyz;
                vNormal = normalMatrix * normal;
                gl_Position = projectionMatrix * mvPosition;
                
                //test for bumpmap
                view = normalize (- vec3( modelViewMatrix * mvPosition));
                tbase = mat3(modelViewMatrix) * tangent_base;
                
                
                
#ifdef USE_LOGDEPTHBUF
               gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;
  #ifdef USE_LOGDEPTHBUF_EXT
               vFragDepth = 1.0 + gl_Position.w;
  #else
               gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;
  #endif
#endif
        }

    </script>

    <!-- Fragment Shader -->
    <script type="x-shader/x-fragment" id="fragmentShader_1">
        uniform sampler2D dayTexture;
        uniform sampler2D nightTexture;
        uniform sampler2D specularTexture;
        uniform sampler2D bumpTexture;

        varying vec4 mvPosition;
        varying vec3 sunDirection;
        varying vec2 vUv;
        varying vec3 vNormal;
            
        uniform float scale;
        uniform float displacement;
        uniform float time;
        
        
        //test bumpmap
        uniform mat4 modelViewMatrix;
        varying vec3 view;
        varying vec3 tbase;
        
        
        //varying float vNoise;
        
        //
        // GLSL textureless classic 3D noise "cnoise",
        // with an RSL-style periodic variant "pnoise".
        // Author:  Stefan Gustavson (stefan.gustavson@liu.se)
        // Version: 2011-10-11
        //
        // Many thanks to Ian McEwan of Ashima Arts for the
        // ideas for permutation and gradient selection.
        //
        // Copyright (c) 2011 Stefan Gustavson. All rights reserved.
        // Distributed under the MIT license. See LICENSE file.
        // https://github.com/ashima/webgl-noise
        //
        
        vec3 mod289(vec3 x)
        {
        return x - floor(x * (1.0 / 289.0)) * 289.0;
        }
        
        vec4 mod289(vec4 x)
        {
        return x - floor(x * (1.0 / 289.0)) * 289.0;
        }
        
        vec4 permute(vec4 x)
        {
        return mod289(((x*34.0)+1.0)*x);
        }
        
        vec4 taylorInvSqrt(vec4 r)
        {
        return 1.79284291400159 - 0.85373472095314 * r;
        }
        
        vec3 fade(vec3 t) {
        return t*t*t*(t*(t*6.0-15.0)+10.0);
        }
        
        // Classic Perlin noise
        float cnoise(vec3 P)
        {
        vec3 Pi0 = floor(P); // Integer part for indexing
        vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
        Pi0 = mod289(Pi0);
        Pi1 = mod289(Pi1);
        vec3 Pf0 = fract(P); // Fractional part for interpolation
        vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
        vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
        vec4 iy = vec4(Pi0.yy, Pi1.yy);
        vec4 iz0 = Pi0.zzzz;
        vec4 iz1 = Pi1.zzzz;
        
        vec4 ixy = permute(permute(ix) + iy);
        vec4 ixy0 = permute(ixy + iz0);
        vec4 ixy1 = permute(ixy + iz1);
        
        vec4 gx0 = ixy0 * (1.0 / 7.0);
        vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
        gx0 = fract(gx0);
        vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
        vec4 sz0 = step(gz0, vec4(0.0));
        gx0 -= sz0 * (step(0.0, gx0) - 0.5);
        gy0 -= sz0 * (step(0.0, gy0) - 0.5);
        
        vec4 gx1 = ixy1 * (1.0 / 7.0);
        vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
        gx1 = fract(gx1);
        vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
        vec4 sz1 = step(gz1, vec4(0.0));
        gx1 -= sz1 * (step(0.0, gx1) - 0.5);
        gy1 -= sz1 * (step(0.0, gy1) - 0.5);
        
        vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
        vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
        vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
        vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
        vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
        vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
        vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
        vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
        
        vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
        g000 *= norm0.x;
        g010 *= norm0.y;
        g100 *= norm0.z;
        g110 *= norm0.w;
        vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
        g001 *= norm1.x;
        g011 *= norm1.y;
        g101 *= norm1.z;
        g111 *= norm1.w;
        
        float n000 = dot(g000, Pf0);
        float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
        float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
        float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
        float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
        float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
        float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
        float n111 = dot(g111, Pf1);
        
        vec3 fade_xyz = fade(Pf0);
        vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
        vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
        float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
        return 2.2 * n_xyz;
        }
        

#include <logdepthbuf_pars_fragment>

			void main( void ) {
#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)
        gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;
#endif
				vec3 dayColor   = texture2D( dayTexture, vUv ).rgb;
                vec3 nightColor = texture2D( nightTexture, vUv ).rgb;
                vec3 specColor  = texture2D(specularTexture, vUv).rgb;    
                
                vec3 n_in = normalize(vNormal);
                vec3 n_bump = normalize( vec3(2.0)* texture2D(bumpTexture, vUv).rgb - vec3(1.0));
                
                vec3 tangent_x = normalize( cross(tbase, n_in) );
                vec3 tangent_y = normalize( cross(n_in, tangent_x) );
                mat3 tangent = mat3( tangent_x, tangent_y, n_in );
                vec3 n = tangent * n_bump;
                
                //+ .1*vec3(sin(dot(vec2(375765.0,232473.0),vUv)),sin(dot(vec2(586785.0,934634.0),vUv)),0.0));
                vec3 sun = normalize (sunDirection);
                
                float vNoise = cnoise(vec3(vUv, time) * scale);
                vNoise *= 2.0; 
                vec3 pos = vNoise * vec3(displacement);
                vec3 water = vec3(  specColor.x * pos.x * time*0.93,
                                specColor.y * pos.y * time*0.64,
                                specColor.z * pos.z * time*1.61  );
                vec3 n_water = normalize (water);
                
                //n = normalize (vNormal);
                
                vec3 halfway     = normalize (sun + normalize (-mvPosition.xyz));

                float dotSun = max(dot(n, sun), 0.0);
                float dotHalfway = max(dot(n, halfway), 0.0);

                vec3 diffuse = dayColor * dotSun  +  nightColor * pow (1.0 - dotSun, 5.0);
                vec3 specular= 0.6 * specColor * pow (dotHalfway, 100.0);
                
                vec3 mix = specular + diffuse + clamp( n_water, 0.0, 0.04);
                
                gl_FragColor = vec4(mix, 1.0 );
                
                //gl_FragColor = vec4(mix.x * bumpColor.x, mix.y * bumpColor.y, mix.z * bumpColor.z, 1.0 );
                //gl_FragColor = vec4( diffuse + specular, 1.0 );
                //gl_FragColor.r = 1.0;
            

        }

    </script>

    <script>
        //Here the three.js functions
        var universe = buildUniverse();
        loadData("data/datas.json", universe);
         //var dim_ui = build3D_UI();
    </script>

</body>

</html>
